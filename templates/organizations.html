{% extends "base.html" %}

{% block title %}AmbaLearn Dashboard - Organizations{% endblock %}

{% block content %}
<div class="page-header">
    <h1>Organizations</h1>
    <p>Manage partner organizations and their access</p>
</div>

<!-- Add Organization Form -->
<div class="card mb-4">
    <div class="card-body">
        <h5 class="card-title"><i class="bi bi-building-add"></i> Add New Organization</h5>
        <form action="/add_organization" method="post">
            <div class="input-group mb-3">
                <input type="text" class="form-control" name="organization_name" placeholder="Enter organization name"
                    required>
            </div>
            <div class="input-group mb-3">
                <textarea class="form-control" name="description" placeholder="Description (Optional)"
                    rows="2"></textarea>
            </div>
            <div class="input-group mb-3">
                <select class="form-select" name="manager_id">
                    <option value="">Select Manager (Optional)</option>
                    {% for user in users %}
                    <option value="{{ user.id }}">{{ user.username }} ({{ user.email }})</option>
                    {% endfor %}
                </select>
            </div>
            <div class="input-group mb-3">
                <!-- In a real app we might wan't to assign an existing user as manager or invite one. 
                          For simplicity here, we'll let admin assign an existing user as manager at creation if they wish, 
                          but typically manager creates org or we assign later. Keeping it simple. -->
                <button class="btn btn-primary" type="submit">
                    <i class="bi bi-plus-lg"></i> Add
                </button>
            </div>
        </form>
    </div>
</div>

<!-- Organizations Table -->
<div class="card">
    <div class="card-body">
        <h5 class="card-title"><i class="bi bi-building"></i> All Organizations</h5>
        <table class="table">
            <thead>
                <tr>
                    <th scope="col">#</th>
                    <th scope="col">Name</th>
                    <th scope="col">Manager</th>
                    <th scope="col">Members</th>
                    <th scope="col">Actions</th>
                </tr>
            </thead>
            <tbody>
                {% for org in organizations %}
                <tr>
                    <th scope="row">{{ org.id }}</th>
                    <td>
                        <div style="display: flex; align-items: center; gap: 12px;">
                            <div
                                style="width: 40px; height: 40px; background: linear-gradient(135deg, rgba(59, 130, 246, 0.15) 0%, rgba(45, 212, 191, 0.15) 100%); border-radius: 10px; display: flex; align-items: center; justify-content: center;">
                                <i class="bi bi-building"
                                    style="color: var(--color-primary-light); font-size: 18px;"></i>
                            </div>
                            <strong>{{ org.name }}</strong>
                        </div>
                    </td>
                    </td>
                    <td>
                        {% if org.manager %}
                        <div class="d-flex align-items-center">
                            <div
                                style="width: 24px; height: 24px; background: var(--gradient-primary); border-radius: 50%; display: flex; align-items: center; justify-content: center; color: white; font-size: 10px; margin-right: 6px;">
                                {{ org.manager.username[0].upper() }}
                            </div>
                            <small>{{ org.manager.username }}</small>
                        </div>
                        {% else %}
                        <span class="text-secondary small">N/A</span>
                        {% endif %}
                    </td>
                    <td>
                        <span class="badge bg-secondary">{{ org.users | length }} members</span>
                    </td>
                    <td>
                        <a href="/organization/{{ org.id }}" class="btn btn-sm btn-outline-primary">
                            <i class="bi bi-eye"></i> View
                        </a>
                        <a href="/edit_organization/{{ org.id }}" class="btn btn-sm btn-outline-warning">
                            <i class="bi bi-pencil"></i> Edit
                        </a>
                        <a href="/delete_organization/{{ org.id }}" class="btn btn-sm btn-outline-danger"
                            onclick="return confirm('Are you sure?');">
                            <i class="bi bi-trash"></i> Delete
                        </a>
                    </td>
                </tr>
                {% endfor %}
                {% if not organizations %}
                <tr>
                    <td colspan="4" class="text-center" style="padding: 48px; color: var(--color-text-secondary);">
                        <i class="bi bi-building-x" style="font-size: 48px; opacity: 0.5;"></i>
                        <p style="margin-top: 16px;">No organizations found. Add your first organization!</p>
                    </td>
                </tr>
                {% endif %}
            </tbody>
        </table>
    </div>
</div>
{% endblock %}